machine:
  environment:
    # Use the same port as Selenium server.
    DRIVER_PORT: 4444
    # Use the same base URL as Selenium server.
    DRIVER_BASE_URL: wd/hub
test:
  pre:
    - chromedriver --port=$DRIVER_PORT --url-base=$DRIVER_BASE_URL:
        background: true
    # Wait for server.
    - wget --retry-connrefused --waitretry=1 --output-document=/dev/null http://localhost:$DRIVER_PORT/$DRIVER_BASE_URL/status
    - npm start:
        background: true
deployment:
  production:
    branch: master
    commands:
      - ssh -l openfisca legislation.openfisca.fr "cd legislation-explorer; ./deploy_prod.sh"
